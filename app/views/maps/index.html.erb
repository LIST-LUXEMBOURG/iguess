<%# Include some JS functions we need to makes the maps work %>
<%= render :partial => 'mapScripts.html.erb' %>

<div id="data">
<table id="dataSetsTable" class="zebra sortable" width="180px">
    <thead>
      <tr><th>Dataset name</th></tr>
    </thead>
    <tbody>
      <% @datasets.each do |d| %>
        <tr class='layer-for-city-<%= d.city_id %> all-layers'>  <!--- First and last below should be layer name -->
          <td><a href=# onclick="WebGIS.addNewLayer('<%= d.identifier%>','<%= d.server_url%>','<%= d.identifier%>')"><%= d.identifier%></a> </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  A new layer can be added to the map by clicking on the dataset name.
</div>

<div style="float: left; width:100%; min-height:100%; margin:2px;" id="BroadMap"></div>


  <!-- Don't know why we have to include this here, as it's already auto-included in the header, but if
        we omit this line, it just doesn't work... odd -->

  <script type="text/javascript">
    $(function() {
      var theTable = $('#sortable_table')

      theTable.find("tbody > tr").find("td:eq(1)").mousedown(function(){
        $(this).prev().find(":checkbox").click()
      });

      $("#filter").keyup(function() {
        $.uiTableFilter( theTable, this.value );
      })

      $('#filter-form').submit(function(){
        theTable.find("tbody > tr:visible > td:eq(1)").mousedown();
        return false;
      }).focus(); //Give focus to input field
    });
  </script>




